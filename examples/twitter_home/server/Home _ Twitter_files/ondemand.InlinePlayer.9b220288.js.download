(window.webpackJsonp=window.webpackJsonp||[]).push([[225],{"64vW":function(t,e,i){"use strict";var s=i("ERkP");const a=i.n(s).a.createContext({heightsReady:!0});e.a=a},QHXq:function(t,e,i){"use strict";i.r(e),i.d(e,"InlinePlayerContainer",(function(){return W}));var s=i("97Jx"),a=i.n(s),r=i("ERkP"),n=i.n(r),o=i("r1tX"),l=i("HT/6"),c=i("fs1G"),h=i("gOg7"),p=i("64vW"),d=i("Zl35"),u=i("9Xij"),y=i("rHpw"),_=i("epkG"),m=i("mN6z"),b=i("aITJ"),P=i("MWbm");const g=t=>{t.stopPropagation()};var v=({children:t,testID:e})=>n.a.createElement(P.a,{onClick:g,style:y.a.absoluteFill,testID:e},t),I=i("v6aA"),C=i("efbI"),f=i("v/3V"),A=i("eXeu"),w=i("6v1f"),S=i("zHh/"),E=i("mf9H"),R=i("f8Yq"),k="videoPlayer";const T=new _.a({});class O extends n.a.Component{constructor(t,e){super(t,e),this._emitter=null,this._playerInternal=null,this._placementRef=null,this._isLooping=!1,this._isPlayerFullscreen=!1,this._renderHorizonPlayer=t=>{const{accessibilityLabel:e,analytics:i,aspectRatio:s,displayOptions:r,durationMs:o,geolocationPrompt:l,includeBroadcastEventAssociation:c,intentToPlayTime:h,language:p,mediaAvailability:u,noAuthHttpClient:y,playerId:_,publisherId:m,source:{contentId:b,eventId:P,videoId:g,vmapUrl:v},timecode:I,twitterAuthedHttpClient:f,uiStack:A,videoEl:w,videoPlayer:S,viewCount:E}=this.props;return n.a.createElement(C.a.Consumer,null,(({prerollDisplayLocation:C})=>n.a.createElement(d.b,a()({accessibilityLabel:e,adProvider:this._tweetAdProvider(C),analytics:i,aspectRatio:s,basePlayerClass:S,configType:"static",contentId:b,cta:this._getPlayerCTA(),disableHls:this._disableHls,durationMs:o,enableVideoPlayerCaptionRendering:!0,eventId:P,featureProvider:this.context.featureSwitches,geolocationPrompt:l,httpClient:y,includeBroadcastEventAssociation:c,initiallyMutedCaptions:!0,intentToPlayTime:h,language:p,mediaAvailability:u,objectFitVideo:r&&r.objectFitVideo,onApiReady:this._handleApiReady,playbackSessionId:g.id,playerId:_,precache:this._shouldAutoplay,publisherId:m,requestedTimecode:I,twitterAuthedHttpClient:f,videoEl:w,videoId:g,viewCount:E,vmapUrl:v},t),A)))},this._setPlayerApi=t=>{const{customOverlay:e,onMuteChange:i,onSetPlayerApi:s}=this.props;"function"==typeof e&&(this._playerInternal=t,this.forceUpdate()),i&&(t.on("unmute",(()=>i({isPlayerMuted:!1}))),t.on("mute",(()=>i({isPlayerMuted:!0})))),t&&(t.on("fullscreenEntered",(()=>this._handleFullscreenChange({isPlayerFullscreen:!0}))),t.on("fullscreenExited",(()=>this._handleFullscreenChange({isPlayerFullscreen:!1})))),this._setPlayerInternal(t),s&&s(t)},this._getPlayerCTA=()=>{const{cta:t,promotedContent:e}=this.props;return t&&{...t,url:Object(f.a)(this.context.featureSwitches,t.url,null==e?void 0:e.click_tracking_info)}},this._handleApiReady=this._setPlayerApi,this._getLoopingThreshold=()=>{const{loopingThresholdMs:t,source:{videoId:e}}=this.props;return t||"tweet"===e.type&&6e4||7e3},this._handleAutoPlayRequest=()=>{const{onAutoplay:t,shouldAutoplayWithoutMuting:e}=this.props;this._playerInternal&&(e?this._playerInternal.play():this._playerInternal.playPreview(),t&&t())},this._handlePauseRequest=()=>{const{onAutopause:t}=this.props;this._playerInternal&&(this._playerInternal.pause(),t&&t())},this._handlePlacementChange=t=>{this._emitter&&!this._isPlayerFullscreen&&this._emitter.signalPlacementChange(t),this._playerInternal&&!this._isPlayerFullscreen&&this._playerInternal.updatePosition(t.getPositionData())},this._handlePageVisibilityChange=(t,e)=>{const i=e.getPositionData();"hidden"===t&&this._playerInternal?this._playerInternal.updatePosition({percentVisible:0,percentOfViewportOccupied:0,sizesInfo:i.sizesInfo}):"visible"===t&&this._playerInternal&&this._playerInternal.updatePosition(i)},this._handlePlaybackComplete=t=>{const{onPlaybackComplete:e}=this.props;this._emitter&&this._emitter.signalPlaybackFinish(null==t?void 0:t.shouldLoop),e&&e()},this._handlePlaybackStarted=()=>{this._emitter&&this._emitter.signalPlay(),this.props.onPlaybackStarted&&this.props.onPlaybackStarted()},this._handlePlaybackPaused=()=>{this._emitter&&this._emitter.signalPause()},this._handlePlayerState=t=>{const{onPlayerState:e,onProgressChange:i}=this.props;e&&e(t);const s=(t.tracks||[]).find((e=>e.id===t.currentTrackId));if(s){const e=(s.currentTimeMs||0)/s.durationMs;i&&i(e,t.tracksFinished)}},this._handleError=t=>{const{onError:e}=this.props,{error:i}=t;i?(this._emitter&&(this._emitter.unregister(),this._emitter=void 0,this._hasInitialPlacementMeasurement=!1,this._lastPlayerError=i),t.errorInfo&&!t.errorInfo.canRetry&&(e&&e(),this._onErrorUnsubscribe&&this._onErrorUnsubscribe())):!this._emitter&&this._lastPlayerError&&(this._registerPlaybackCoordination(),this._submitInitialPlacement(),this._lastPlayerError=void 0)},this._handleFullscreenChange=t=>{const e=this.context.viewport;if(this._isPlayerFullscreen=t.isPlayerFullscreen,e){if(e.temporarilySuppressScrollListeners(2e3),b.b.isChrome()||b.b.isSafari())if(this._isPlayerFullscreen)this._savedScrollPosition={y:e.scrollY(),x:e.scrollX()};else if(this._savedScrollPosition){const{x:t,y:i}=this._savedScrollPosition;this._savedScrollPosition=void 0,e.scrollTo(t,i)}this._isPlayerFullscreen&&this._playerInternal?this._playerInternal.updatePosition({percentVisible:1,percentOfViewportOccupied:1,sizesInfo:{viewportSize:e.getRect2D(),mediaSize:e.getRect2D()}}):!this._isPlayerFullscreen&&this._placementRef&&this._placementRef.sample(this._handlePlacementChange)}const{onFullscreenChange:i}=this.props;i&&i(t),this._emitter&&this._emitter.signalFullscreenChange(t.isPlayerFullscreen)},this._registerPlaybackCoordination=()=>{const{autoplayGroupOptions:t,playbackCoordination:e,playbackPriority:i}=this.props,s={autoplayGroupOptions:t,onAutoPlayRequest:this._handleAutoPlayRequest,onPauseRequest:this._handlePauseRequest,canAutoplay:this._shouldAutoplay,isLooping:this._isLooping,playbackPriority:i};e&&(this._emitter=e.register(s))},this._setPlayerInternal=t=>{if(this._playerInternal=t,t){const{onPlayerState:e,onProgressChange:i}=this.props;(e||i)&&t.subscribe(this._handlePlayerState),this._onErrorUnsubscribe=t.subscribe(this._handleError),t.on("playbackComplete",this._handlePlaybackComplete),t.on("play",this._handlePlaybackStarted),t.on("pause",this._handlePlaybackPaused),this._registerPlaybackCoordination(),this._submitInitialPlacement()}if(this.props.setPlayer){const t=this._playerInternal&&{play:()=>{this._playerInternal&&this._playerInternal.play()},pause:()=>{this._playerInternal&&this._playerInternal.pause()},replay:()=>{this._playerInternal&&this._playerInternal.replay()}};this.props.setPlayer(t)}},this._setPlacementAPI=t=>{this._placementRef=t,this._submitInitialPlacement()},this._getTweetId=()=>{const{source:{videoId:t}}=this.props;if(t){if("tweet"===t.type)return t.id;if("broadcast"===t.type)return t.tweetId}},this._tweetAdProvider=t=>{const e=this._getTweetId();if(e)return()=>this.props.tweetAdProvider(e,t)};const{autoplay:i,disableAutoplay:s,forwardPivotInfo:r}=t;this._disableHls=!(b.b.isDesktopOS()||b.b.isAndroid()&&this.context.featureSwitches.isTrue("web_video_hls_android_mse_enabled")),this._shouldAutoplay=!s&&Object(S.a)(i,r)}componentDidUpdate(t){const{heightsReady:e,playbackPriority:i}=this.props;!t.heightsReady&&e&&this._submitInitialPlacement(),!Object(m.a)(t.source,this.props.source)&&this._emitter&&this._emitter.reset(),t.playbackPriority!==i&&void 0!==i&&this._emitter&&this._emitter.signalPlaybackPriorityChange(i,this._shouldAutoplay)}render(){const{aspectRatio:t}=this.props;return n.a.createElement(u.a,{ratio:t,style:L.aspectRatio},n.a.createElement(R.a,{onChange:this._handlePlacementChange,onPageVisibilityChange:this._handlePageVisibilityChange,ref:this._setPlacementAPI,style:y.a.absoluteFill},this._renderPlayer()))}componentWillUnmount(){this._emitter&&(this._emitter.unregister(),this._emitter=null),this._onErrorUnsubscribe&&this._onErrorUnsubscribe()}_renderPlayer(){const{autoplayGroupOptions:t,dataSaverMode:e,durationMs:i,forceLoop:s,maxLoopCount:a,poster:r,promotedContent:o,source:{variants:l},videoType:c}=this.props,h="animated_gif"===c,p="vine"===c,d=l&&l.length?h?"gif":"media_entity":"vmap";this._isLooping=!!(s||h||p||i&&i<=this._getLoopingThreshold());const u={contentType:d,loop:this._isLooping,maxLoopCount:this._isLooping?a:void 0,maxLoopingThresholdSec:t?6:void 0,poster:r&&r.url,promotedContext:o&&(o.impression_id||o.disclosure_type)?{impressionId:o.impression_id,disclosureType:o.disclosure_type}:void 0,shouldCapBitrate:e,variants:l?Object(A.e)(l):[]};return n.a.createElement(v,{testID:k},this._renderHorizonPlayer(u))}_submitInitialPlacement(){const{heightsReady:t}=this.props,e=t&&!this._hasInitialPlacementMeasurement;this._emitter&&this._placementRef&&e&&(this._placementRef.sample(this._handlePlacementChange),this._hasInitialPlacementMeasurement=!0)}}O.contextType=I.a,O.defaultProps={autoplay:w.b.Off,playbackCoordination:E.b,playbackPriority:l.a.NORMAL,showControls:!0,dataSaverMode:!1,geolocationPrompt:!0,heightsReady:!0,noAuthHttpClient:T,includeBroadcastEventAssociation:!1};const L=y.a.create({aspectRatio:{zIndex:void 0}});var F=i("mqpi"),x=i("0KEI"),H=i("wrlS"),V=i("rxPX"),M=i("yr4d"),D=i("6rlp"),j=i("RqPI"),q=i("H9MA"),z=i("XOJV");const N=()=>(t,e,{api:i})=>i.getHttpClient(),U=(t,e)=>{const i=e.source&&e.source.videoId;return i&&"tweet"===i.type?i.id:void 0};var B=Object(V.a)().propsFromState((()=>({dataSaverMode:q.c,featureSwitches:H.d,language:j.q,sourceTweet:z.a.createHydratedTweetSelector(U)}))).adjustStateProps((({dataSaverMode:t,featureSwitches:e,language:i,sourceTweet:s})=>({dataSaverMode:t,disableAutoplay:!!s&&Object(F.b)(e,s,F.a.Autoplay),language:i,mediaAvailability:s&&Object(A.c)(s)||void 0,publisherId:s?Object(A.d)(s):void 0}))).propsFromActions((()=>({createLocalApiErrorHandler:Object(x.createLocalApiErrorHandlerWithContextFactory)("INLINE_PLAYER_CONTAINER"),getTwitterAuthedHttpClient:N,logPromotedVideoEvent:D.b,tweetAdProvider:M.b}))).withAnalytics();class W extends n.a.PureComponent{constructor(t,e){super(t,e),this._player=null,this._getBaseItem=t=>{const{analytics:e,includeBroadcastEventAssociation:i,source:{videoId:s}}=this.props,{event_id:a}=e.contextualScribeData;let r;return r="broadcast"===s.type&&s.tweetId?s.tweetId:"broadcast"===s.type&&i&&a?a:s.id,t.find((t=>t.id===r))},this._createAnalytics=t=>{const e={log:this._scribeAction},{analytics:i}=this.props,s={log:this.context.featureSwitches.isTrue("responsive_web_video_promoted_logging_enabled")?this._logPromotedVideoEvent:c.a},a=i.contextualScribeNamespace,r=i.contextualScribeData,n={scribeContext:{...a},baseScribeItem:Array.isArray(r.items)?this._getBaseItem(r.items):void 0,enableShortFormCompleteLogging:this.context.featureSwitches.isTrue("responsive_web_video_pcomplete_enabled")};return new h.a(e,s,t,n)},this._logPromotedVideoEvent=t=>{const{createLocalApiErrorHandler:e}=this.props;this.props.logPromotedVideoEvent(t).catch(e())},this._scribeAction=t=>{const{category:e,data:i,namespace:s}=t,{analytics:a}=this.props;null!=s&&s.action&&a.scribe({...s,data:{...i,_category_:e}})},this._setPlayer=t=>{if(this._player=t,this.props.setPlayer){const t=this._player&&{play:()=>{this._player&&this._player.play()},pause:()=>{this._player&&this._player.pause()},replay:()=>{this._player&&this._player.replay()}};this.props.setPlayer(t)}},this._twitterAuthedHttpClient=t.getTwitterAuthedHttpClient(),this._analytics=this._createAnalytics(this._twitterAuthedHttpClient)}render(){const{createLocalApiErrorHandler:t,getTwitterAuthedHttpClient:e,playbackPriority:i,tweetAdProvider:s,...r}=this.props;return n.a.createElement(p.a.Consumer,null,(({heightsReady:t})=>n.a.createElement(o.a.Consumer,null,(({playbackPriority:e})=>n.a.createElement(O,a()({},r,{analytics:this._analytics,heightsReady:t,playbackPriority:e===l.a.INELIGIBLE?e:i,setPlayer:this._setPlayer,tweetAdProvider:s,twitterAuthedHttpClient:this._twitterAuthedHttpClient}))))))}}W.contextType=I.a;const X=B(W);e.default=X},f8Yq:function(t,e,i){"use strict";i("kYxP");var s=i("ERkP"),a=i.n(s),r=i("vF3p"),n=i("S4UJ"),o=i("gZV8"),l=i("ylrv");class c{constructor(t,e,i){this.placement=t,this.obstructions=e,this.layerId=i}getPositionData(){return{percentVisible:this.visibleFraction(),percentOfViewportOccupied:this.placement.viewportOccupiedFraction(),sizesInfo:{viewportSize:this.placement.viewport,mediaSize:this.placement.item}}}visibleFraction(){const t=this.placement.visiblePart();if(!t)return 0;const e=this.layerId?this.obstructions.getObstructionAboveLayer(this.layerId,t):this.obstructions.getTotalObstruction(t),i=l.a.area(this.placement.item),s=(1-e)*l.a.area(t);return i>0?s/i:0}top(){return this.placement.item.top}distanceToCenter(){return this.placement.verticalDistanceToViewportCenter()}distanceToTop(){return this.placement.verticalDistanceToViewportTop()}scrollY(){return this.placement.scrollY}}class h extends a.a.Component{constructor(...t){super(...t),this._handlePageVisibilityChange=()=>{if(this._placement){const{layerId:t,obstructionDetection:e,onPageVisibilityChange:i}=this.props,s=document.visibilityState,a=this._obstructions||e.getObstructions(),r=new c(this._placement,a,t);i&&i(s,r)}},this._handlePlacementChange=t=>{this._updateAndNotify({placement:t},this.props.onChange)},this._handleObstructionChange=()=>{const{obstructionDetection:t,onChange:e}=this.props;this._updateAndNotify({obstructions:t.getObstructions()},e)},this._setPlacementRef=t=>{this._placementRef=t}}sample(t){this._placementRef&&this._placementRef.sample((e=>{this._updateAndNotify({placement:e},t)}))}render(){const{children:t,style:e}=this.props;return a.a.createElement(o.e,{onPlacementChange:this._handlePlacementChange,ref:this._setPlacementRef,style:e,withScrollListener:!0},t)}componentDidMount(){const{obstructionDetection:t}=this.props;this._obstructionSubscription=t.subscribe(this._handleObstructionChange),document.addEventListener("visibilitychange",this._handlePageVisibilityChange)}componentWillUnmount(){this._obstructionSubscription&&(this._obstructionSubscription.unsubscribe(),this._obstructionSubscription=void 0),document.removeEventListener("visibilitychange",this._handlePageVisibilityChange)}_updateAndNotify({obstructions:t,placement:e},i){const{layerId:s,obstructionDetection:a}=this.props;this._placement=e||this._placement,this._obstructions=t||this._obstructions||a.getObstructions(),this._placement?i(new c(this._placement,this._obstructions,s)):this._placementRef&&this._placementRef.sample((t=>{this._placement=t,this._obstructions=this._obstructions||a.getObstructions(),i(new c(t,this._obstructions,s))}))}}h.defaultProps={obstructionDetection:r.a};const p=Object(n.a)(h);e.a=p}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/ondemand.InlinePlayer.9b220288.js.map