(window.webpackJsonp=window.webpackJsonp||[]).push([[182],{"Pc/x":function(e,t,i){"use strict";i.d(t,"a",(function(){return S}));i("849X");var n=i("epkG"),r=i("CEs6"),o=i("SrIh"),a=i("RqPI");class s extends Error{constructor(e,t,i){super(`${s.displayName}: ${e} HTTP-${t} message: ${i}`),this.url=e,this.status=t}}s.displayName="ProxseeApiError";let c,u=0;const l="X-Idempotence",p={["X-Periscope-User-Agent"]:"Twitter/m5",["X-Attempt"]:1};function h(){const e=Date.now();return u=e<=u?u+1:e,Object.assign({},p,{[l]:u,"content-type":"application/json"})}const d="m5-proxsee-login-a2011357b73e",y={},g={host:"https://proxsee.pscp.tv",errorFilter:function(e,t){return t(e).then((t=>{return t.status&&((i=t.status)<200||i>399)?Promise.reject(function(e,t){const{uri:i}=e,{status:n}=t,o=Object(r.a)(t);return new s(i,n,o.msg)}(e,t)):t;var i}))}};const m=Object.freeze({SelfHarm:"SELF_HARM",Violence:"VIOLENCE",SexualContent:"SEXUAL_CONTENT",ChildSafety:"CSE",PrivateInformation:"PRIVATE_INFO",AbusiveBehavior:"HARASSMENT"}),f=new class{constructor(e=y){this.reportSpaceFor={SelfHarm:e=>this._reportSpace({abuse_type:m.SelfHarm,...e}),Violence:e=>this._reportSpace({abuse_type:m.Violence,...e}),SexualContent:e=>this._reportSpace({abuse_type:m.SexualContent,...e}),ChildSafety:e=>this._reportSpace({abuse_type:m.ChildSafety,...e}),PrivateInformation:e=>this._reportSpace({abuse_type:m.PrivateInformation,...e}),AbusiveBehavior:e=>this._reportSpace({abuse_type:m.AbusiveBehavior,...e})};const{httpConfig:t}=e;this.client=new n.a({...g,...t}),this._authToken=void 0,this._authPromise=null}init(e){c=e}initialized(){return!!c}isLoggedIn(){return!!this._authToken}isTwitterAuthenticated(){if(!this.initialized())return!1;const e=c.store.getState();return Object(a.o)(e)}authToken(){return this._authToken}dispatch(e){return this.initialized()?this.client.dispatch(e).then(r.a):Promise.reject(new Error("[ProxseeApi] config not initialized"))}post(e,t,i={}){const{params:n}=i,r=Object.assign(h(),i.headers),o=JSON.stringify({...t,cookie:this._authToken}),a="Twitter"===this._authUserType?`twitter/${e}`:e;return this.dispatch({method:"POST",path:`/api/v2/${a}`,headers:r,params:n,data:o})}login(){return this._authPromise?this._authPromise:this.initialized()?this.isTwitterAuthenticated()?this.isLoggedIn()?Promise.resolve():(this._authPromise=c.api.Auth.authenticatePeriscope().then((e=>this.loginTwitterToken(e.token))).then((e=>{if(!e)throw new Error("[ProxseeApi] invalid loginTwitterToken response");this._authToken=e.cookie,this._authUserType=e.type})).catch((e=>{const t={err:e};Object(o.a)("[ProxseeApi] failed to login",{extra:t})})).then((()=>{this._authPromise=null})),this._authPromise):Promise.resolve():Promise.reject(new Error("[ProxseeApi] config not initialized"))}loginTwitterToken(e){const t={jwt:e,vendor_id:d,create_user:!1,direct:!0};return this.post("loginTwitterToken",t)}publicPath(e){return this.isLoggedIn()?e:`${e}Public`}accessChat(e){return this.login().then((()=>this.post(this.publicPath("accessChat"),{chat_token:e})))}getChatHistory(e,t={}){return this.login().then((()=>{const{params:i}=t,n=Object.assign(h(),t.headers),r=JSON.stringify({access_token:e.access_token,cursor:e.cursor,limit:1e3,since:null,quick_get:!0});return this.dispatch({method:"POST",host:e.host,path:e.path,headers:n,params:i,data:r})}))}createClip(e){return this.login().then((()=>this.post("createClip",e).catch((e=>{Object(o.a)("[ProxseeApi] failed to create clip",{extra:{err:e}})}))))}getClip(e){return this.login().then((()=>this.post("getClip",{clip_id:e}).catch((e=>{Object(o.a)("[ProxseeApi] failed to get clip",{extra:{err:e}})}))))}_reportSpace(e){return this.login().then((()=>this.post("markAbuse",e).catch((e=>{Object(o.a)("[ProxseeApi] failed to report space",{extra:{err:e}})}))))}};var b=i("G6rE");let P;const _=new Error("[AudioModule] config not initialized");var S=new class{constructor(){this.proxsee=f}init(e){P=e,f.init(P)}initialized(){return!!P}loggedInUser(){if(this.initialized()){const e=P.store.getState();return b.e.selectLoggedInUser(e)}}audioSpace(e){return P?P.api.AudioSpaces.byId(e):Promise.reject(_)}subscribeToScheduledSpace(e){return P?P.api.AudioSpaces.subscribeToScheduledSpaceById(e):Promise.reject(_)}unsubscribeFromScheduledSpace(e){return P?P.api.AudioSpaces.unsubscribeFromScheduledSpaceById(e):Promise.reject(_)}searchAudioSpace(e,t){return P?P.api.AudioSpaces.search(e,t):Promise.reject(_)}}},u2Vg:function(e,t,i){"use strict";i.r(t),i.d(t,"__DANGEROUS_IMPORT_VIDEOPLAYER_BASE__",(function(){return S})),i.d(t,"__DANGEROUS_IMPORT__",(function(){return A}));i("kYxP");var n=i("ERkP"),r=i.n(n),o=i("MWbm"),a=i("HT/6"),s=i("Zl35"),c=i("rHpw"),u=i("epkG"),l=i("lklz"),p=i("88qn"),h=i("mf9H"),d=i("v6aA"),y=i("rxPX");const g=()=>(e,t,{api:i})=>i.getHttpClient();var m=Object(y.a)().propsFromActions((()=>({getTwitterAuthedHttpClient:g}))).withAnalytics(),f=i("gOg7"),b=i("Pc/x");function P(e){const{featureSwitches:t}=r.a.useContext(d.a),{acquisitionParams:i,broadcastId:n,isLive:o,isLooping:s,media:c,mediaKey:u,onEnded:y,onPlaybackEmitterCreated:g,onPlayerApi:m,onPlayerState:P,requestedTimecode:S,shouldAutoplayMuted:A}=e,[C,v]=r.a.useState(null),w=r.a.useRef({playbackCoordinationEmitter:null,previousPlayerState:null}),E=c||n&&u;if(r.a.useEffect((()=>{null===C&&E&&Object(p.a)({showControls:!1,source:{}},t).then((e=>v((()=>e))))}),[C,E,t]),r.a.useEffect((()=>function(){const{playbackCoordinationEmitter:e}=w.current;e&&e.unregister()}),[]),null===C||!E)return null;const x=Boolean(o&&n&&u),O=!x&&A,I=x?a.a.SPACE:a.a.NORMAL;const j={analytics:function(e,t){const i={scribeContext:{...e.analytics.contextualScribeNamespace},enableShortFormCompleteLogging:t.isTrue("responsive_web_video_pcomplete_enabled"),periscopeAuthToken:b.a.proxsee.authToken()},n={log:t=>{const{category:i,data:n,namespace:r}=t;null!=r&&r.action&&e.analytics.scribe({...r,data:{...n,_category_:i}})}};return new f.a(n,{log:()=>{}},e.getTwitterAuthedHttpClient(),i)}(e,t),basePlayerClass:C,httpClient:k,onApiReady:function(t){var i;O||t.play(),"function"==typeof m&&m(t);const n=null==c||null==(i=c.video_info)?void 0:i.duration_millis;"number"==typeof n&&"number"==typeof S&&t.scrubToFraction(S/n);const r={onAutoPlayRequest:function(){O&&t.playPreview()},onPauseRequest:function(){e.disablePlaybackCoordination||t.pause()},playbackPriority:I,canAutoplay:Boolean(A),isLooping:Boolean(s)};w.current.playbackCoordinationEmitter=h.b.register(r),g&&g(w.current.playbackCoordinationEmitter)},onStateUpdate:function(e,t){"function"==typeof P&&P(e,t),function(e){const t=T(e);e.isPlaying&&t&&t.durationMs===t.currentTimeMs&&"function"==typeof y&&(y(),w.current.playbackCoordinationEmitter&&w.current.playbackCoordinationEmitter.signalPlaybackFinish())}(e),function(e){const{playbackCoordinationEmitter:t,previousPlayerState:i}=w.current,n=null===i,r=null==i?void 0:i.isPlaying,o=e.isPlaying,a=!n&&r&&!o;!n&&r||!o?a&&t&&t.signalPause():t&&t.signalPlay()}(e),w.current.previousPlayerState=e},twitterAuthedHttpClient:e.getTwitterAuthedHttpClient()};if(n&&u){const e={...j,configType:"static",contentId:u,contentType:"broadcast",variants:[],videoId:l.b.forAudioSpace(n,u,o,i)};return r.a.createElement(_,{key:n,playerConfig:e})}if(c){const e={...j,configType:"static",contentId:c.id_str,loop:!1,contentType:"media_entity",durationMs:c.video_info.duration_millis,variants:c.video_info.variants.map((({bitrate:e,content_type:t,url:i})=>({type:t,src:i})))};return r.a.createElement(_,{key:c.id_str,playerConfig:e})}return null}function _({playerConfig:e}){return r.a.createElement(o.a,{style:C.displayNone},r.a.createElement(s.b,e))}const S=P,A=m(P),T=e=>e&&e.tracks[e.currentTrackId],k=new u.a({}),C=c.a.create((e=>({displayNone:{display:"none"}})))}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/loader.AudioOnlyVideoPlayer.2be82328.js.map